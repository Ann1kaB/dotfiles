#!/bin/sh

#commands
CPUTEMP=$(sensors | awk '/^Tctl:/ {printf "%d\n", $2}' | sed 's/$/°C/')
CPU=$(cpupower frequency-info | awk '/frequency:/ {print $4$5}' | tail -n +3)
MEM=$(free -h | awk '/^Mem:/ {print $3}' | sed 's/Gi/GB/g')
#if [ $(optimus-manager --status | awk '/^Current GPU mode/{print $5}') != "igpu" ] ; then # technically not required anymore with turing GPUs.
GPUTEMP=$(nvidia-smi | awk '{print $3}' | xargs | awk '{print $7}' | sed 's/C/°C/')
GPU=$(nvidia-smi -q | egrep 'Used|Total|Graphics|Power Draw' | awk '/:/ {print $3,$4}' | sed -n '1p;8p;2p;6p;5p' | xargs | awk '{print $3"MB/"$1"MB" "/" $7"MHz" "/" $6"W"}' | sed 's/MB\/MB\/MHz/OFF/;s/^/\//')
#fi
# WIFI=$(nmcli dev wifi | awk '/^*/{print $8"dB"}')
WIFI2=$(nmcli dev show wlp3s0 | awk '/STATE:/{print $3}' | sed 's/(connected)/ON/;s/(disconnected)/OFF/')
# seems to cause issues on new laptop rtl8822ce driver, so disabled for now.
# WIFIBAND=$(nmcli dev wifi | awk '/^*/ {print ($5<14)? 2.4"GHz" : $5}' | awk '{print ($1>14)? 5"GHz" : $1}')
BAT=$(acpi -b | sed 's/.*, \([0-9]*\)%.*/\1/g')
GPUSTAT=$(optimus-manager --status | awk '/^Current GPU mode/{print $5}')
num=$(ls /sys/devices/platform/faustus/hwmon | grep hwmon)
CPUFAN=$(cat /sys/devices/platform/faustus/hwmon/$num/fan1_input)
GPUFAN=$(cat /sys/devices/platform/faustus/hwmon/$num/fan2_input)

	xsetroot -name "MEM:$MEM // CPU:$CPUTEMP/$CPU/FAN:${CPUFAN}RPM/GPU:$GPUTEMP$GPU/FAN:${GPUFAN}RPM // BAT:$BAT% // WIFI:$WIFI2"
